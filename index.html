<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Everyday Store – MLBB Top-Up</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f6f7fb;
    padding: 20px;
  }
  .box {
    background: #fff;
    padding: 15px;
    border-radius: 12px;
    max-width: 420px;
    margin: auto;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  }
  input, select, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    background: #4f46e5;
    color: white;
    font-weight: 600;
    cursor: pointer;
  }
  .qr-box {
    text-align: center;
    margin-top: 15px;
  }
  #processingBox, #successBox {
    display: none;
    text-align: center;
    margin-top: 15px;
  }
</style>
</head>

<body>

<div class="box">
  <h3>MLBB Diamond Top-Up</h3>

  <input id="playerID" placeholder="Player ID">
  <input id="serverID" placeholder="Server ID">
  <input id="mobile" placeholder="Mobile Number">

  <select id="pack" onchange="updateQR()">
    <option value="">Select Pack</option>

    <option value="./qr/qr-3.png">3 Diamonds - ₹8</option>
    <option value="./qr/qr-5.png">5 Diamonds - ₹12</option>
    <option value="./qr/qr-11.png">11 Diamonds - ₹23</option>
    <option value="./qr/qr-22.png">22 Diamonds - ₹35</option>

    <option value="./qr/qr-55.png">55 Diamonds - ₹81</option>
    <option value="./qr/qr-86.png">86 Diamonds - ₹118</option>
    <option value="./qr/qr-112.png">112 Diamonds - ₹155</option>
    <option value="./qr/qr-172.png">172 Diamonds - ₹227</option>
    <option value="./qr/qr-257.png">257 Diamonds - ₹319</option>

    <option value="./qr/qr-514.png">514 Diamonds - ₹637</option>
    <option value="./qr/qr-706.png">706 Diamonds - ₹855</option>
    <option value="./qr/qr-1050.png">1050 Diamonds - ₹1275</option>
    <option value="./qr/qr-1135.png">1135 Diamonds - ₹1385</option>
    <option value="./qr/qr-2195.png">2195 Diamonds - ₹2560</option>
    <option value="./qr/qr-3688.png">3688 Diamonds - ₹4475</option>
    <option value="./qr/qr-5532.png">5532 Diamonds - ₹6450</option>
    <option value="./qr/qr-9288.png">9288 Diamonds - ₹10950</option>

    <option value="./qr/qr-weekly-1.png">1 Weekly Pass - ₹133</option>
    <option value="./qr/qr-weekly-172.png">Weekly + 172 Diamonds - ₹360</option>
    <option value="./qr/qr-weekly-2.png">2 Weekly Passes - ₹366</option>
  </select>

  <div class="qr-box">
    <img id="qrImage" style="display:none; width:220px;">
  </div>

  <button id="orderBtn" onclick="sendOrder()">Order After Payment</button>

  <div id="processingBox">⏳ Processing...</div>
  <div id="successBox">
    ✅ Order placed<br>
    <span id="orderIdText"></span>
  </div>
</div>

<!-- ================= JS ================= -->
<script type="module">
  /* ---------- Firebase imports ---------- */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp,
    doc,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  /* ---------- Firebase config ---------- */
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "XXXX",
    appId: "XXXX"
  };

  /* ---------- Init ---------- */
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  window.db = db;

  /* ---------- STORE OPEN / CLOSE (GLOBAL) ---------- */
  const storeRef = doc(db, "settings", "store");

  onSnapshot(storeRef, (snap) => {
    if (!snap.exists()) return;

    const status = snap.data().status;
    const btn = document.getElementById("orderBtn");

    if (status === "closed") {
      btn.disabled = true;
      btn.innerText = "Store Closed";
      btn.style.opacity = "0.6";
    } else {
      btn.disabled = false;
      btn.innerText = "Order After Payment";
      btn.style.opacity = "1";
    }
  });

  /* ---------- QR UPDATE ---------- */
  window.updateQR = function () {
    const pack = document.getElementById("pack");
    const qr = document.getElementById("qrImage");

    if (!pack.value) {
      qr.style.display = "none";
      qr.src = "";
      return;
    }

    qr.src = pack.value + "?t=" + Date.now();
    qr.style.display = "block";
  };

  /* ---------- SEND ORDER ---------- */
  window.sendOrder = async function () {
    const playerID = document.getElementById("playerID").value.trim();
    const serverID = document.getElementById("serverID").value.trim();
    const mobile = document.getElementById("mobile").value.trim();
    const pack = document.getElementById("pack");

    if (!playerID || !serverID || !mobile || !pack.value) {
      alert("Please fill all details and select a pack");
      return;
    }

    const orderId = "ORD-" + Date.now();

    await addDoc(collection(db, "orders"), {
      orderId,
      playerID,
      serverID,
      mobile,
      pack: pack.options[pack.selectedIndex].text,
      status: "pending",
      createdAt: serverTimestamp()
    });

    document.getElementById("orderIdText").innerText = orderId;
    document.getElementById("processingBox").style.display = "block";

    const mailLink =
      "mailto:storeeveryday26@gmail.com" +
      "?subject=New MLBB Order" +
      "&body=" +
      encodeURIComponent(
        "Order ID: " + orderId + "\n" +
        "Player ID: " + playerID + "\n" +
        "Server ID: " + serverID + "\n" +
        "Mobile: " + mobile + "\n" +
        "Pack: " + pack.options[pack.selectedIndex].text
      );

    setTimeout(() => {
      document.getElementById("processingBox").style.display = "none";
      document.getElementById("successBox").style.display = "block";
    }, 1200);

    setTimeout(() => {
      window.open(mailLink, "_blank");
    }, 2000);
  };
</script>
